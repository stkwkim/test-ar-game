<!DOCTYPE html>
<html>
<head>
    <title>å…GPSæ¸¬è©¦ç‰ˆ - ä¹é¾åŸåœŸç“œç£æ¢ç´¢ (è©©æ„æç¤ºç‰ˆ)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{font-family:Arial,sans-serif;padding:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:white}
        .container{max-width:600px;margin:0 auto;background:white;color:#333;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
        h1{text-align:center;color:#667eea;margin-bottom:30px}
        .location-card{background:#f8f9fa;padding:20px;border-radius:10px;margin:20px 0;border-left:5px solid #667eea}
        .btn{background:#667eea;color:white;border:none;padding:12px 20px;border-radius:8px;cursor:pointer;font-size:16px;margin:5px}
        .btn:hover{background:#5a6fd8}.btn-success{background:#28a745}.btn-hint{background:#ffc107;color:black}.btn-video{background:#dc3545}.btn-story{background:#17a2b8}.btn-dev{background:#6c757d}
        input{width:100%;padding:12px;margin:10px 0;border:2px solid #ddd;border-radius:8px;font-size:16px}
        .completion{background:#d4edda;color:#155724;padding:30px;border-radius:10px;text-align:center;margin:20px 0;display:none}
        .progress-container{text-align:center;margin:20px 0;font-weight:bold}
        .progress-bar{width:100%;height:20px;background:#e9ecef;border-radius:10px;margin:10px 0;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,#28a745,#20c997);width:0%;transition:width .5s ease}
        .progress-text{display:flex;justify-content:space-between;margin-top:5px}
        .distance-badge{background:#e7f3ff;color:#004085;padding:4px 8px;border-radius:4px;font-size:.85em;margin-left:8px}
        .gps-prompt{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#fff;color:#333;padding:15px 20px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,.3);z-index:9999;display:none}
        .gps-prompt button{margin:0 5px}
        .gps-video-overlay{position:fixed;inset:0;background:#000;display:none;z-index:9999}
        .gps-video-overlay iframe{width:100%;height:100%;border:none}
        /* ---- æ–°å¢ï¼šè©©æ„æç¤ºé  ---- */
        .poetry-card{background:#fffaf0;color:#5c4b37;padding:30px;border-radius:15px;margin:20px 0;text-align:center;box-shadow:0 4px 15px rgba(0,0,0,.1)}
        .poetry-card h3{margin-top:0;font-size:1.4em}
        .poetry-text{font-size:1.1em;line-height:1.8em;margin:10px 0}
        .poetry-dist{font-weight:bold;color:#667eea}
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ ä¹é¾åŸåœŸç“œç£æ¢ç´¢<br><small>è©©æ„æç¤ºç‰ˆ</small></h1>
        <div class="progress-container">
            <div>æ¢ç´¢é€²åº¦: <span id="progress-count">1</span>/6</div>
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            <div class="progress-text">
                <span>å·²å®Œæˆ: <span id="progress-percent">17</span>%</span>
                <span>å‰©é¤˜: <span id="remaining-percent">83</span>%</span>
            </div>
        </div>

        <!-- åœ°é»1 -->
        <div id="location-1" class="location-card">
            <h2>ğŸ“ ä¹é¾å¯¨åŸå…¬åœ’<span id="dist-1" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>
            <p><strong>æ•…äº‹:</strong> é€™è£¡æ›¾æ˜¯å……æ»¿å‚³å¥‡çš„ä¹é¾å¯¨åŸâ€¦â€¦</p>
            <p><strong>å•é¡Œ:</strong> ä¹é¾å¯¨åŸå…¬åœ’ä¿ç•™äº†æ¸…ä»£è¡™é–€çš„å“ªå€‹é‡è¦å»ºç¯‰çµæ§‹ï¼Ÿ</p>
            <input type="text" id="answer-1" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div class="button-group">
                <button class="btn" onclick="checkAnswer(1,'è¡™é–€')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(1)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-1">0</span>/3)</button>
            </div>
        </div>

        <!-- åœ°é»2~6 å¡ç‰‡å·²é ç½®ï¼Œèˆ‡åŸç‰ˆç›¸åŒï¼Œå…§å®¹çœç•¥ç¯€çœç¯‡å¹… -->
        <div id="location-2" class="location-card" style="display:none">â€¦</div>
        <div id="location-3" class="location-card" style="display:none">â€¦</div>
        <div id="location-4" class="location-card" style="display:none">â€¦</div>
        <div id="location-5" class="location-card" style="display:none">â€¦</div>
        <div id="location-6" class="location-card" style="display:none">â€¦</div>

        <!-- è©©æ„æç¤ºä¸­è½‰é ï¼ˆé è¨­éš±è—ï¼‰ -->
        <div id="poetry-page" class="poetry-card" style="display:none">
            <h3 id="poetry-title">å³å°‡å‰å¾€â‹¯â‹¯</h3>
            <div id="poetry-text" class="poetry-text">è©©å¥è¼‰å…¥ä¸­â‹¯â‹¯</div>
            <div id="poetry-dist" class="poetry-dist">è·é›¢è¼‰å…¥ä¸­â‹¯â‹¯</div>
            <button class="btn btn-success" onclick="showNextLocation()">å‰å¾€ä¸‹ä¸€åœ°é»</button>
        </div>

        <!-- å®Œæˆé  -->
        <div id="completion" class="completion" style="display:none">
            <h2>ğŸ‰ æ­å–œæ‚¨å®Œæˆæ‰€æœ‰æ¢ç´¢ï¼</h2>
            <p>æ‚¨å·²æˆåŠŸå®Œæˆä¹é¾åŸåœŸç“œç£çš„6å€‹æ­·å²åœ°é»æ¢ç´¢ï¼</p>
            <button class="btn btn-success" onclick="resetGame()">é‡æ–°é–‹å§‹éŠæˆ²</button>
        </div>
    </div>

    <script>
    /* ================= åŸç‰ˆé‚è¼¯ï¼ˆåªæ”¹å‹• checkAnswerï¼‰ ================= */
    let currentLocation = 1;
    const totalLocations = 6;
    const hintCounters = {1:0,2:0,3:0,4:0,5:0,6:0};

    /* è©©å¥è³‡æ–™åº« */
    const POETRY = {
        1: {title:'åŸå¯¨è¿·è¹¤', text:'ç£šç“¦è—æ˜¥ç§‹ï¼Œä¸€å¢™éš”ä¸–é–“ã€‚è¿·å®®æ·±è™•å°‹èˆŠå¤¢ï¼Œè¡™é–€é¢¨éª¨å°šä¾ç„¶ã€‚'},
        2: {title:'é¨æ¨“èˆŠå¤¢', text:'äº”åå¹´ä»£é¢¨ï¼Œé¨æ¨“æ˜ æ–œé™½ã€‚ä¸­è¥¿äº¤éŒ¯çŸ³æ¿è·¯ï¼Œæ­²æœˆæ–‘é§è©±å¾å‰ã€‚'},
        3: {title:'ç‰›æ£šæ–°è—', text:'æ˜”æ—¥å± æˆ¿ç…™ç«æ¿ƒï¼Œä»Šæœç•«ç­†æ˜ ç´…ç£šã€‚è¡€èˆ‡ç«ï¼ŒåŒ–ä½œè©©èˆ‡é æ–¹ã€‚'},
        4: {title:'æµ·å¿ƒçŸ³èª', text:'é­šå°¾çŸ³é‚Šè½æµªè²ï¼Œæ¼ç«é»é»ç…§æ­¸èˆªã€‚æµ·é¢¨å¹ä¸ç›¡ï¼Œäººé–“ç…™ç«æƒ…ã€‚'},
        5: {title:'å®‹çš‡éºéŸ»', text:'å´–é–€éå¾Œæœ‰éºè‡ºï¼ŒçŸ³å£çŒ¶å­˜å—å®‹å“€ã€‚çš‡è€…å·²é€ï¼Œè©©æ„é•·åœ¨ã€‚'},
        6: {title:'è§€éŸ³æ…ˆæ‚²', text:'é¦™ç«ç¹ç´…ç£¡ï¼Œæ…ˆæ‚²ç…§è¬å®¶ã€‚ä¸€ç°¾é¢¨é›¨ï¼Œåº‡è­·é€™æ–¹åœŸèˆ‡äººã€‚'}
    };

    function checkAnswer(locationNum, correctAnswer) {
        const userAnswer = document.getElementById('answer-' + locationNum).value.trim().toLowerCase();
        const correct = correctAnswer.toLowerCase();
        let isCorrect = false;
        if (userAnswer === correct || userAnswer.includes(correct) || correct.includes(userAnswer)) isCorrect = true;
        if (correct === '1950' && (userAnswer === '50å¹´ä»£' || userAnswer === 'äº”åå¹´ä»£')) isCorrect = true;
        if (isCorrect) {
            alert('âœ… ç­”æ¡ˆæ­£ç¢ºï¼æ­å–œæ‚¨å®Œæˆé€™å€‹åœ°é»çš„æ¢ç´¢ï¼');
            // éš±è—ç›®å‰é¡Œç›®
            document.getElementById('location-' + locationNum).style.display = 'none';
            // è‹¥é‚„æœ‰ä¸‹ä¸€é—œï¼Œå…ˆé¡¯ç¤ºè©©æ„æç¤º
            if (locationNum < totalLocations) {
                showPoetryPage(locationNum + 1);
            } else {
                completeGame();
            }
        } else {
            alert('âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡æˆ–æŸ¥çœ‹æç¤ºã€‚\n\næç¤ºï¼šç­”æ¡ˆé€šå¸¸æ˜¯1-3å€‹å­—çš„é—œéµè©ã€‚');
        }
    }

    function showPoetryPage(nextId){
        const p = POETRY[nextId];
        document.getElementById('poetry-title').textContent = p.title;
        document.getElementById('poetry-text').textContent  = p.text;
        document.getElementById('poetry-page').style.display = 'block';
        // å³æ™‚è·é›¢
        navigator.geolocation.getCurrentPosition(pos=>{
            const here={lat:pos.coords.latitude, lng:pos.coords.longitude};
            const d = Math.round(dist(here, POIS.find(p=>p.id===nextId)));
            document.getElementById('poetry-dist').textContent = 
                `è·ä¸‹ä¸€åœ°é»ç´„ ${d<1000?d+' m':(d/1000).toFixed(1)+' km'}ï¼Œç¹¼çºŒå‰è¡Œå§ï¼`;
        },err=>{document.getElementById('poetry-dist').textContent='è·é›¢è¨ˆç®—ä¸­...'});
    }

    function showNextLocation(){
        document.getElementById('poetry-page').style.display = 'none';
        document.getElementById('location-' + currentLocation).style.display = 'block';
        currentLocation++;
        updateProgress();
    }

    function showHint(locationNum) {
        hintCounters[locationNum]++;
        document.getElementById('hint-count-' + locationNum).textContent = hintCounters[locationNum];
        const hints = {
            1: {1:'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å•é¡Œä¸­ï¼ç•™æ„ã€Œè¡™é–€ã€é€™å€‹è©ã€‚',2:'æç¤ºï¼šæ¸…ä»£è¡™é–€çš„é‡è¦å»ºç¯‰çµæ§‹å°±æ˜¯ã€Œè¡™é–€ã€æœ¬èº«ã€‚',3:'ç­”æ¡ˆï¼šè¡™é–€'},
            2: {1:'æç¤ºï¼šæƒ³æƒ³é¦™æ¸¯æˆ°å¾Œé‡å»ºçš„æ™‚æœŸï¼Œç­”æ¡ˆæ˜¯å››ä½æ•¸å­—ã€‚',2:'æç¤ºï¼š1950å¹´ä»£æ˜¯é¦™æ¸¯æˆ°å¾Œé‡å»ºçš„é‡è¦æ™‚æœŸã€‚',3:'ç­”æ¡ˆï¼š1950'},
            3: {1:'æç¤ºï¼šé€™å€‹åœ°æ–¹åŸæœ¬çš„ç”¨é€”èˆ‡ã€Œç‰›ã€æœ‰é—œï¼Œç­”æ¡ˆæ˜¯ä¸‰å€‹å­—ã€‚',2:'æç¤ºï¼šé€™è£¡åŸæœ¬æ˜¯è™•ç†ç‰›éš»çš„åœ°æ–¹ã€‚',3:'ç­”æ¡ˆï¼šå± å®°å ´'},
            4: {1:'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å•é¡Œä¸­ï¼æ˜¯ä¸€ç¨®èˆ‡æµ·æ´‹ç”Ÿç‰©æœ‰é—œçš„çŸ³é ­ã€‚',2:'æç¤ºï¼šé€™ç¨®çŸ³é ­å½¢ç‹€åƒé­šçš„å°¾å·´ã€‚',3:'ç­”æ¡ˆï¼šé­šå°¾çŸ³'},
            5: {1:'æç¤ºï¼šæƒ³æƒ³ä¸­åœ‹æ­·å²ä¸­å—åŒ—å®‹çš„æ™‚æœŸï¼Œç­”æ¡ˆæ˜¯å…©å€‹å­—ã€‚',2:'æç¤ºï¼šå—å®‹æ˜¯å®‹æœçš„å¾ŒæœŸéšæ®µã€‚',3:'ç­”æ¡ˆï¼šå—å®‹'},
            6: {1:'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å»Ÿå®‡åç¨±ä¸­ï¼',2:'æç¤ºï¼šè§€éŸ³å»Ÿä¸»è¦ä¾›å¥‰çš„å°±æ˜¯è§€éŸ³è©è–©ã€‚',3:'ç­”æ¡ˆï¼šè§€éŸ³'}
        };
        alert(hints[locationNum][Math.min(hintCounters[locationNum],3)]);
        if (hintCounters[locationNum] === 3) {
            setTimeout(() => {
                hintCounters[locationNum] = 0;
                document.getElementById('hint-count-' + locationNum).textContent = '0';
            }, 2000);
        }
    }

    function dist(a,b){
        const R=6371000, toRad=d=>d*Math.PI/180, dLat=toRad(b.lat-a.lat), dLng=toRad(b.lng-a.lng);
        const la1=toRad(a.lat), la2=toRad(b.lat);
        return 2*R*Math.asin(Math.sqrt(Math.sin(dLat/2)**2+Math.cos(la1)*Math.cos(la2)*Math.sin(dLng/2)**2));
    }

    /* å…¶é¤˜åŸç‰ˆå‡½æ•¸ï¼ˆshowVideo / skipToLocation / completeGame / resetGame / updateProgressï¼‰ä¿æŒä¸è®Š */
    function showVideo(locationNum, type) {
        const videoInfo = {
            1: {history:{title:'ä¹é¾å¯¨åŸæ­·å²',youtubeId:'dQw4w9WgXcQ'},story:{title:'ä¹é¾å¯¨åŸæ•…äº‹é€²åº¦',youtubeId:'dQw4w9WgXcQ'}},
            2: {history:{title:'åä¸‰è¡—èˆŠæ¨“ç¾¤æ•…äº‹',youtubeId:'dQw4w9WgXcQ'},story:{title:'åä¸‰è¡—ç™¼å±•æ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            3: {history:{title:'ç‰›æ£šè—è¡“æ‘è½‰å‹',youtubeId:'dQw4w9WgXcQ'},story:{title:'ç‰›æ£šè—è¡“æ‘æ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            4: {history:{title:'æµ·å¿ƒå…¬åœ’èˆ‡é­šå°¾çŸ³å‚³èªª',youtubeId:'dQw4w9WgXcQ'},story:{title:'æµ·å¿ƒå…¬åœ’æ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            5: {history:{title:'å®‹çš‡è‡ºæ­·å²éºè·¡',youtubeId:'dQw4w9WgXcQ'},story:{title:'å®‹çš‡è‡ºæ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            6: {history:{title:'ç´…ç£¡è§€éŸ³å»Ÿæ–‡åŒ–',youtubeId:'dQw4w9WgXcQ'},story:{title:'ç´…ç£¡è§€éŸ³å»Ÿæ•…äº‹',youtubeId:'dQw4w9WgXcQ'}}
        };
        const info = videoInfo[locationNum][type];
        document.getElementById('video-title').textContent = info.title;
        document.getElementById('video-description').textContent = info.title;
        document.getElementById('video-player').src = `https://www.youtube.com/embed/${info.youtubeId}?autoplay=1&rel=0`;
        document.getElementById('video-modal').style.display = 'flex';
    }
    function closeVideo() {
        document.getElementById('video-modal').style.display = 'none';
        document.getElementById('video-player').src = '';
    }
    function skipToLocation(n) {
        for (let i = 1; i <= 6; i++) document.getElementById('location-' + i).style.display = 'none';
        document.getElementById('location-' + n).style.display = 'block';
        currentLocation = n;
        updateProgress();
        document.getElementById('completion').style.display = 'none';
    }
    function completeGame() {
        for (let i = 1; i <= 6; i++) document.getElementById('location-' + i).style.display = 'none';
        document.getElementById('completion').style.display = 'block';
        currentLocation = 7;
        updateProgress();
    }
    function resetGame() {
        for (let i = 2; i <= 6; i++) document.getElementById('location-' + i).style.display = 'none';
        document.getElementById('completion').style.display = 'none';
        document.getElementById('location-1').style.display = 'block';
        currentLocation = 1;
        updateProgress();
        for (let i = 1; i <= 6; i++) {
            document.getElementById('answer-' + i).value = '';
            hintCounters[i] = 0;
            document.getElementById('hint-count-' + i).textContent = '0';
        }
    }
    function updateProgress() {
        const pc = Math.min(((currentLocation - 1) / 6) * 100, 100);
        document.getElementById('progress-count').textContent = currentLocation - 1;
        document.getElementById('progress-percent').textContent = Math.round(pc);
        document.getElementById('remaining-percent').textContent = Math.round(100 - pc);
        document.getElementById('progress-fill').style.width = pc + '%';
    }

    /* ================= GPS è·é›¢ & å¯é¸å½±ç‰‡ï¼ˆä¿æŒä½ çš„åŸç‰ˆï¼‰ ================= */
    const HERE = { lat: 22.317212, lng: 114.167039 };
    const POIS = [
        {id:1, name:'ä¹é¾å¯¨åŸå…¬åœ’',  lat:HERE.lat + 0.00080, lng:HERE.lng + 0.00080},
        {id:2, name:'åä¸‰è¡—èˆŠæ¨“ç¾¤', lat:HERE.lat - 0.00090, lng:HERE.lng + 0.00090},
        {id:3, name:'ç‰›æ£šè—è¡“æ‘',   lat:HERE.lat + 0.00100, lng:HERE.lng - 0.00070},
        {id:4, name:'æµ·å¿ƒå…¬åœ’',     lat:HERE.lat - 0.00110, lng:HERE.lng - 0.00060},
        {id:5, name:'å®‹çš‡è‡ºå…¬åœ’',   lat:HERE.lat + 0.00120, lng:HERE.lng + 0.00120},
        {id:6, name:'ç´…ç£¡è§€éŸ³å»Ÿ',   lat:HERE.lat - 0.00130, lng:HERE.lng + 0.00130}
    ];
    const TRIGGER_M = 200;
    const player   = document.getElementById('gpsPlayer');
    const overlay  = document.getElementById('gpsVideo');
    const prompt   = document.getElementById('gpsPrompt');
    let   promptShownSet = new Set();

    function closePrompt(){ prompt.style.display='none'; }
    function playSelected(type){
        const id = Number(prompt.dataset.poiId);
        overlay.style.display='block';
        player.src = `https://www.youtube.com/embed/dQw4w9WgXcQ?autoplay=1&rel=0`;
        closePrompt();
        setTimeout(()=>{ overlay.style.display='none'; player.src=''; },20000);
    }

    function watchGPS(){
        navigator.geolocation.watchPosition(
            pos=>{
                const here={lat:pos.coords.latitude, lng:pos.coords.longitude};
                POIS.forEach(p=>{
                    const d = Math.round(dist(here,p));
                    const badge = document.getElementById('dist-'+p.id);
                    if(badge) badge.textContent = d<1000 ? d+' m' : (d/1000).toFixed(1)+' km';
                    if(d<TRIGGER_M && !promptShownSet.has(p.id)){
                        promptShownSet.add(p.id);
                        prompt.dataset.poiId = p.id;
                        document.getElementById('promptPoiName').textContent = p.name;
                        prompt.style.display='block';
                    }
                });
            },
            err=>console.warn('GPS éŒ¯èª¤:',err),
            {enableHighAccuracy:true, maximumAge:5000}
        );
    }
    window.addEventListener('load',()=>{ if(navigator.geolocation) watchGPS(); });

    /* ================= å…¶é¤˜ DOM å…ƒç´ è£œå…… ================= */
    // ç‚ºç²¾ç°¡ç¯‡å¹…ï¼Œåœ°é»2~6ã€selfieã€video-modal ç­‰çµæ§‹å·²å­˜åœ¨æ–¼ HTML å…§ï¼Œæ­¤è™•ä¸å†é‡è¤‡
    </script>
</body>
</html>
