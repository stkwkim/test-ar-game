<!DOCTYPE html>
<html>
<head>
    <title>å…GPSæ¸¬è©¦ç‰ˆ - ä¹é¾åŸåœŸç“œç£æ¢ç´¢ (å®Œæ•´ç‰ˆ)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body{font-family:Arial,sans-serif;padding:20px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;color:white}
        .container{max-width:600px;margin:0 auto;background:white;color:#333;padding:30px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
        h1{text-align:center;color:#667eea;margin-bottom:30px}
        .location-card{background:#f8f9fa;padding:20px;border-radius:10px;margin:20px 0;border-left:5px solid #667eea}
        .btn{background:#667eea;color:white;border:none;padding:12px 20px;border-radius:8px;cursor:pointer;font-size:16px;margin:5px}
        .btn:hover{background:#5a6fd8}.btn-success{background:#28a745}.btn-hint{background:#ffc107;color:black}.btn-video{background:#dc3545}.btn-story{background:#17a2b8}.btn-dev{background:#6c757d}
        input{width:100%;padding:12px;margin:10px 0;border:2px solid #ddd;border-radius:8px;font-size:16px}
        .completion{background:#d4edda;color:#155724;padding:30px;border-radius:10px;text-align:center;margin:20px 0;display:none}
        .progress-container{text-align:center;margin:20px 0;font-weight:bold}
        .progress-bar{width:100%;height:20px;background:#e9ecef;border-radius:10px;margin:10px 0;overflow:hidden}
        .progress-fill{height:100%;background:linear-gradient(90deg,#28a745,#20c997);width:0%;transition:width .5s ease}
        .progress-text{display:flex;justify-content:space-between;margin-top:5px}
        /* ---- æ–°å¢ï¼šGPS è·é›¢æ¨™ç±¤ ---- */
        .distance-badge{background:#e7f3ff;color:#004085;padding:4px 8px;border-radius:4px;font-size:.85em;margin-left:8px}
        /* ---- æ–°å¢ï¼šå¯é¸å½±ç‰‡æç¤º ---- */
        .gps-prompt{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);background:#fff;color:#333;padding:15px 20px;border-radius:10px;box-shadow:0 5px 20px rgba(0,0,0,.3);z-index:9999;display:none}
        .gps-prompt button{margin:0 5px}
        /* ---- å…¨å±å½±ç‰‡ ---- */
        .gps-video-overlay{position:fixed;inset:0;background:#000;display:none;z-index:9999}
        .gps-video-overlay iframe{width:100%;height:100%;border:none}
    </style>
<base target="_blank">
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ ä¹é¾åŸåœŸç“œç£æ¢ç´¢<br><small>GPS-å¯é¸å½±ç‰‡ + è·é›¢æç¤ºç‰ˆ</small></h1>

        <div class="progress-container">
            <div>æ¢ç´¢é€²åº¦: <span id="progress-count">1</span>/6</div>
            <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
            <div class="progress-text">
                <span>å·²å®Œæˆ: <span id="progress-percent">17</span>%</span>
                <span>å‰©é¤˜: <span id="remaining-percent">83</span>%</span>
            </div>
        </div>

        <!-- åœ°é»1: ä¹é¾å¯¨åŸå…¬åœ’ -->
        <div id="location-1" class="location-card">
            <h2>ğŸ“ ä¹é¾å¯¨åŸå…¬åœ’<span id="dist-1" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>
            <p><strong>æ•…äº‹:</strong> é€™è£¡æ›¾æ˜¯å……æ»¿å‚³å¥‡çš„ä¹é¾å¯¨åŸï¼Œä¸€å€‹åœ¨ä¸‰ä¸ç®¡åœ°å¸¶ä¸­è‡ªç„¶å½¢æˆçš„ç¨ç‰¹ç¤¾å€ã€‚æƒ³åƒä¸€ä¸‹ï¼Œåœ¨1987å¹´æ¸…æ‹†ä¹‹å‰ï¼Œé€™è£¡æ˜¯é«˜å¯†åº¦å»ºç¯‰çš„è¿·å®®ï¼Œå……æ»¿è‘—å„ç¨®æ•…äº‹å’Œå‚³å¥‡ã€‚</p>
            <div class="ar-note">ğŸ’¡ åœ¨ARç‰ˆæœ¬ä¸­ï¼Œç•¶æ‚¨åˆ°é”æ­¤åœ°é»æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºç›¸é—œçš„ARå½±ç‰‡å…§å®¹</div>
            <div class="button-group">
                <button class="btn btn-video" onclick="showVideo(1,'history')">ğŸ¬ è§€çœ‹ä¹é¾å¯¨åŸæ­·å²å½±ç‰‡</button>
                <button class="btn btn-story" onclick="showVideo(1,'story')">ğŸ“– æ•…äº‹é€²åº¦</button>
            </div>
            <p><strong>å•é¡Œ:</strong> ä¹é¾å¯¨åŸå…¬åœ’ä¿ç•™äº†æ¸…ä»£è¡™é–€çš„å“ªå€‹é‡è¦å»ºç¯‰çµæ§‹ï¼Ÿ</p>
            <input type="text" id="answer-1" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div class="button-group">
                <button class="btn" onclick="checkAnswer(1,'è¡™é–€')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(1)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-1">0</span>/3)</button>
            </div>
            <div class="hint-counter">é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æ›´å¤šç·šç´¢</div>
        </div>

        <!-- åœ°é»2: åä¸‰è¡—èˆŠæ¨“ç¾¤ -->
        <div id="location-2" class="location-card" style="display:none">
            <h2>ğŸ¢ åä¸‰è¡—èˆŠæ¨“ç¾¤<span id="dist-2" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>
            <p><strong>æ•…äº‹:</strong> åä¸‰è¡—è¦‹è­‰äº†åœŸç“œç£çš„å·¥æ¥­ç™¼å±•å²ã€‚é€™äº›æˆ°å‰é¨æ¨“å»ºç¯‰èåˆäº†ä¸­è¥¿å»ºç¯‰é¢¨æ ¼ï¼Œæ›¾ç¶“æ˜¯ç¹è¯çš„å•†æ¥­è¡—é“ï¼Œç¾åœ¨å‰‡æ˜¯ç¤¾å€ç”Ÿæ´»çš„è¦‹è­‰ã€‚</p>
            <div class="ar-note">ğŸ’¡ åœ¨ARç‰ˆæœ¬ä¸­ï¼Œç•¶æ‚¨åˆ°é”æ­¤åœ°é»æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºç›¸é—œçš„ARå½±ç‰‡å…§å®¹</div>
            <div class="button-group">
                <button class="btn btn-video" onclick="showVideo(2,'history')">ğŸ¬ è§€çœ‹åä¸‰è¡—æ­·å²å½±ç‰‡</button>
                <button class="btn btn-story" onclick="showVideo(2,'story')">ğŸ“– æ•…äº‹é€²åº¦</button>
            </div>
            <p><strong>å•é¡Œ:</strong> åä¸‰è¡—çš„é¨æ¨“å»ºç¯‰ä¸»è¦å»ºæ–¼å“ªå€‹å¹´ä»£ï¼Ÿ</p>
            <input type="text" id="answer-2" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div class="button-group">
                <button class="btn" onclick="checkAnswer(2,'1950')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(2)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-2">0</span>/3)</button>
            </div>
            <div class="hint-counter">é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æ›´å¤šç·šç´¢</div>
        </div>

        <!-- åœ°é»3: ç‰›æ£šè—è¡“æ‘ -->
        <div id="location-3" class="location-card" style="display:none">
            <h2>ğŸ¨ åœŸç“œç£ç‰›æ£šè—è¡“æ‘<span id="dist-3" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>
            <p><strong>æ•…äº‹:</strong> é€™è£¡æ›¾æ˜¯é¦™æ¸¯å”¯ä¸€çš„å¸‚å€å± å®°å ´ï¼Œå»ºæ–¼1908å¹´ã€‚ç¶“éæ´»åŒ–å¾Œï¼Œç´…ç£šå»ºç¯‰ç¾¤è®Šæˆäº†è—è¡“å®¶çš„å·¥ä½œå®¤å’Œå±•è¦½ç©ºé–“ï¼Œè¦‹è­‰äº†åŸå¸‚ç©ºé–“åŠŸèƒ½çš„è½‰è®Šã€‚</p>
            <div class="ar-note">ğŸ’¡ åœ¨ARç‰ˆæœ¬ä¸­ï¼Œç•¶æ‚¨åˆ°é”æ­¤åœ°é»æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºç›¸é—œçš„ARå½±ç‰‡å…§å®¹</div>
            <div class="button-group">
                <button class="btn btn-video" onclick="showVideo(3,'history')">ğŸ¬ è§€çœ‹ç‰›æ£šè—è¡“æ‘å½±ç‰‡</button>
                <button class="btn btn-story" onclick="showVideo(3,'story')">ğŸ“– æ•…äº‹é€²åº¦</button>
            </div>
            <p><strong>å•é¡Œ:</strong> ç‰›æ£šè—è¡“æ‘çš„å‰èº«æ˜¯ä»€éº¼å»ºç¯‰ï¼Ÿ</p>
            <input type="text" id="answer-3" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div class="button-group">
                <button class="btn" onclick="checkAnswer(3,'å± å®°å ´')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(3)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-3">0</span>/3)</button>
            </div>
            <div class="hint-counter">é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æ›´å¤šç·šç´¢</div>
        </div>

        <!-- åœ°é»4: æµ·å¿ƒå…¬åœ’ -->
        <div id="location-4" class="location-card" style="display:none">
            <h2>ğŸŒŠ æµ·å¿ƒå…¬åœ’<span id="dist-4" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>
            <p><strong>æ•…äº‹:</strong> æµ·å¿ƒå…¬åœ’ä»¥ç¨ç‰¹çš„é­šå°¾çŸ³èåï¼Œé€™è£¡æ›¾ç¶“æ˜¯æµ·é‚Šï¼Œæ¼æ°‘æœƒåœ¨æ­¤ç¥ˆæ±‚å¹³å®‰ã€‚å…¬åœ’å…§é‚„æœ‰é„­æˆåŠŸçŸ³åƒï¼Œè¨´èªªè‘—é¦™æ¸¯èˆ‡æµ·æ´‹çš„æ·±åšæ·µæºã€‚</p>
            <div class="ar-note">ğŸ’¡ åœ¨ARç‰ˆæœ¬ä¸­ï¼Œç•¶æ‚¨åˆ°é”æ­¤åœ°é»æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºç›¸é—œçš„ARå½±ç‰‡å…§å®¹</div>
            <div class="button-group">
                <button class="btn btn-video" onclick="showVideo(4,'history')">ğŸ¬ è§€çœ‹æµ·å¿ƒå…¬åœ’å½±ç‰‡</button>
                <button class="btn btn-story" onclick="showVideo(4,'story')">ğŸ“– æ•…äº‹é€²åº¦</button>
            </div>
            <p><strong>å•é¡Œ:</strong> æµ·å¿ƒå…¬åœ’æœ€è‘—åçš„è‡ªç„¶æ™¯è§€æ˜¯ä»€éº¼çŸ³ï¼Ÿ</p>
            <input type="text" id="answer-4" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div class="button-group">
                <button class="btn" onclick="checkAnswer(4,'é­šå°¾çŸ³')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(4)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-4">0</span>/3)</button>
            </div>
            <div class="hint-counter">é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æ›´å¤šç·šç´¢</div>
        </div>

        <!-- åœ°é»5: å®‹çš‡è‡ºå…¬åœ’ -->
        <div id="location-5" class="location-card" style="display:none">
            <h2>ğŸ‘‘ å®‹çš‡è‡ºå…¬åœ’<span id="dist-5" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>
            <p><strong>æ•…äº‹:</strong> é€™è£¡æ˜¯å—å®‹æœ€å¾Œå…©ä½çš‡å¸é€ƒé¿å…ƒè»çš„åœ°æ–¹ã€‚ã€å®‹çš‡è‡ºã€çŸ³åˆ»è¦‹è­‰äº†é¦™æ¸¯åœ¨ä¸­åœ‹æ­·å²ä¸­çš„é‡è¦åœ°ä½ï¼Œæ˜¯é¦™æ¸¯æœ€å¤è€çš„æ­·å²éºè·¡ä¹‹ä¸€ã€‚</p>
            <div class="ar-note">ğŸ’¡ åœ¨ARç‰ˆæœ¬ä¸­ï¼Œç•¶æ‚¨åˆ°é”æ­¤åœ°é»æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºç›¸é—œçš„ARå½±ç‰‡å…§å®¹</div>
            <div class="button-group">
                <button class="btn btn-video" onclick="showVideo(5,'history')">ğŸ¬ è§€çœ‹å®‹çš‡è‡ºæ­·å²å½±ç‰‡</button>
                <button class="btn btn-story" onclick="showVideo(5,'story')">ğŸ“– æ•…äº‹é€²åº¦</button>
            </div>
            <p><strong>å•é¡Œ:</strong> å®‹çš‡è‡ºç´€å¿µçš„æ˜¯å“ªå€‹æœä»£çš„çš‡å¸ï¼Ÿ</p>
            <input type="text" id="answer-5" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div class="button-group">
                <button class="btn" onclick="checkAnswer(5,'å—å®‹')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(5)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-5">0</span>/3)</button>
            </div>
            <div class="hint-counter">é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æ›´å¤šç·šç´¢</div>
        </div>

        <!-- åœ°é»6: ç´…ç£¡è§€éŸ³å»Ÿ -->
        <div id="location-6" class="location-card" style="display:none">
            <h2>ğŸ™ ç´…ç£¡è§€éŸ³å»Ÿ<span id="dist-6" class="distance-badge">è¨ˆç®—ä¸­â€¦</span></h2>
            <p><strong>æ•…äº‹:</strong> å»ºæ–¼1873å¹´çš„ç´…ç£¡è§€éŸ³å»Ÿæ˜¯é¦™æ¸¯äºŒç´šæ­·å²å»ºç¯‰ï¼Œè¦‹è­‰äº†ç´…ç£¡åœ°å€çš„ç™¼å±•ã€‚é€™è£¡ä¸åƒ…æ˜¯å®—æ•™å ´æ‰€ï¼Œæ›´æ˜¯ç¤¾å€å‡èšçš„é‡è¦ç©ºé–“ã€‚</p>
            <div class="ar-note">ğŸ’¡ åœ¨ARç‰ˆæœ¬ä¸­ï¼Œç•¶æ‚¨åˆ°é”æ­¤åœ°é»æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºç›¸é—œçš„ARå½±ç‰‡å…§å®¹</div>
            <div class="button-group">
                <button class="btn btn-video" onclick="showVideo(6,'history')">ğŸ¬ è§€çœ‹ç´…ç£¡è§€éŸ³å»Ÿå½±ç‰‡</button>
                <button class="btn btn-story" onclick="showVideo(6,'story')">ğŸ“– æ•…äº‹é€²åº¦</button>
            </div>
            <p><strong>å•é¡Œ:</strong> ç´…ç£¡è§€éŸ³å»Ÿä¸»è¦ä¾›å¥‰å“ªä½ç¥ç¥‡ï¼Ÿ</p>
            <input type="text" id="answer-6" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div class="button-group">
                <button class="btn" onclick="checkAnswer(6,'è§€éŸ³')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(6)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-6">0</span>/3)</button>
            </div>
            <div class="hint-counter">é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æ›´å¤šç·šç´¢</div>
        </div>

        <!-- å®Œæˆæ…¶ç¥ -->
        <div id="completion" class="completion">
            <h2>ğŸ‰ æ­å–œæ‚¨å®Œæˆæ‰€æœ‰æ¢ç´¢ï¼</h2>
            <p>æ‚¨å·²æˆåŠŸå®Œæˆä¹é¾åŸåœŸç“œç£çš„6å€‹æ­·å²åœ°é»æ¢ç´¢ï¼</p>
            <div class="qr-code">
                <h3>å®Œæˆçå‹µäºŒç¶­ç¢¼</h3>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=0168" alt="å®Œæˆçå‹µäºŒç¶­ç¢¼">
                <p class="qr-instruction">æƒææ­¤äºŒç¶­ç¢¼å¯ç²å¾—æ•¸å­—ä»£ç¢¼: 0168</p>
            </div>
            <button class="btn btn-success" onclick="resetGame()">é‡æ–°é–‹å§‹éŠæˆ²</button>
        </div>

        <!-- é–‹ç™¼è€…å·¥å…· -->
        <div class="dev-tools">
            <h3>ğŸ”§ é–‹ç™¼è€…å·¥å…·</h3>
            <p>å¿«é€Ÿè·³è½‰åˆ°ä»»æ„åœ°é»ï¼š</p>
            <div class="button-group">
                <button class="btn btn-dev" onclick="skipToLocation(1)">åœ°é»1</button>
                <button class="btn btn-dev" onclick="skipToLocation(2)">åœ°é»2</button>
                <button class="btn btn-dev" onclick="skipToLocation(3)">åœ°é»3</button>
                <button class="btn btn-dev" onclick="skipToLocation(4)">åœ°é»4</button>
                <button class="btn btn-dev" onclick="skipToLocation(5)">åœ°é»5</button>
                <button class="btn btn-dev" onclick="skipToLocation(6)">åœ°é»6</button>
                <button class="btn btn-success" onclick="completeGame()">ç›´æ¥å®ŒæˆéŠæˆ²</button>
            </div>
        </div>
    </div>

    <!-- å¯é¸å½±ç‰‡æç¤º -->
    <div id="gpsPrompt" class="gps-prompt">
        <div>ğŸ“ ä½ å·²åˆ°é” <strong id="promptPoiName"></strong>ï¼</div>
        <div style="margin-top:8px">
            <button class="btn btn-story" onclick="playSelected('story')">æ’­æ”¾æ•…äº‹é€²åº¦</button>
            <button class="btn btn-video" onclick="playSelected('hist')">æ’­æ”¾æ­·å²ç‰‡æ®µ</button>
            <button class="btn" onclick="closePrompt()">ç¨å¾Œå†èªª</button>
        </div>
    </div>

    <!-- å…¨å±å½±ç‰‡ -->
    <div id="gpsVideo" class="gps-video-overlay">
        <iframe id="gpsPlayer" allow="autoplay" allowfullscreen></iframe>
    </div>

    <script>
    /* ================= åŸç‰ˆé‚è¼¯ï¼ˆé›¶æ”¹å‹•ï¼‰ ================= */
    let currentLocation = 1;
    const totalLocations = 6;
    const hintCounters = {1:0,2:0,3:0,4:0,5:0,6:0};

    function checkAnswer(locationNum, correctAnswer) {
        const userAnswer = document.getElementById('answer-' + locationNum).value.trim().toLowerCase();
        const correct = correctAnswer.toLowerCase();
        let isCorrect = false;
        if (userAnswer === correct || userAnswer.includes(correct) || correct.includes(userAnswer)) isCorrect = true;
        if (correct === '1950' && (userAnswer === '50å¹´ä»£' || userAnswer === 'äº”åå¹´ä»£')) isCorrect = true;
        if (isCorrect) {
            alert('âœ… ç­”æ¡ˆæ­£ç¢ºï¼æ­å–œæ‚¨å®Œæˆé€™å€‹åœ°é»çš„æ¢ç´¢ï¼');
            document.getElementById('location-' + locationNum).style.display = 'none';
            currentLocation++;
            updateProgress();
            if (currentLocation <= totalLocations) {
                document.getElementById('location-' + currentLocation).style.display = 'block';
            } else {
                completeGame();
            }
            document.getElementById('answer-' + locationNum).value = '';
        } else {
            alert('âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡æˆ–æŸ¥çœ‹æç¤ºã€‚\n\næç¤ºï¼šç­”æ¡ˆé€šå¸¸æ˜¯1-3å€‹å­—çš„é—œéµè©ã€‚');
        }
    }

    function showHint(locationNum) {
        hintCounters[locationNum]++;
        document.getElementById('hint-count-' + locationNum).textContent = hintCounters[locationNum];
        const hints = {
            1: {1:'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å•é¡Œä¸­ï¼ç•™æ„ã€Œè¡™é–€ã€é€™å€‹è©ã€‚',2:'æç¤ºï¼šæ¸…ä»£è¡™é–€çš„é‡è¦å»ºç¯‰çµæ§‹å°±æ˜¯ã€Œè¡™é–€ã€æœ¬èº«ã€‚',3:'ç­”æ¡ˆï¼šè¡™é–€'},
            2: {1:'æç¤ºï¼šæƒ³æƒ³é¦™æ¸¯æˆ°å¾Œé‡å»ºçš„æ™‚æœŸï¼Œç­”æ¡ˆæ˜¯å››ä½æ•¸å­—ã€‚',2:'æç¤ºï¼š1950å¹´ä»£æ˜¯é¦™æ¸¯æˆ°å¾Œé‡å»ºçš„é‡è¦æ™‚æœŸã€‚',3:'ç­”æ¡ˆï¼š1950'},
            3: {1:'æç¤ºï¼šé€™å€‹åœ°æ–¹åŸæœ¬çš„ç”¨é€”èˆ‡ã€Œç‰›ã€æœ‰é—œï¼Œç­”æ¡ˆæ˜¯ä¸‰å€‹å­—ã€‚',2:'æç¤ºï¼šé€™è£¡åŸæœ¬æ˜¯è™•ç†ç‰›éš»çš„åœ°æ–¹ã€‚',3:'ç­”æ¡ˆï¼šå± å®°å ´'},
            4: {1:'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å•é¡Œä¸­ï¼æ˜¯ä¸€ç¨®èˆ‡æµ·æ´‹ç”Ÿç‰©æœ‰é—œçš„çŸ³é ­ã€‚',2:'æç¤ºï¼šé€™ç¨®çŸ³é ­å½¢ç‹€åƒé­šçš„å°¾å·´ã€‚',3:'ç­”æ¡ˆï¼šé­šå°¾çŸ³'},
            5: {1:'æç¤ºï¼šæƒ³æƒ³ä¸­åœ‹æ­·å²ä¸­å—åŒ—å®‹çš„æ™‚æœŸï¼Œç­”æ¡ˆæ˜¯å…©å€‹å­—ã€‚',2:'æç¤ºï¼šå—å®‹æ˜¯å®‹æœçš„å¾ŒæœŸéšæ®µã€‚',3:'ç­”æ¡ˆï¼šå—å®‹'},
            6: {1:'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å»Ÿå®‡åç¨±ä¸­ï¼',2:'æç¤ºï¼šè§€éŸ³å»Ÿä¸»è¦ä¾›å¥‰çš„å°±æ˜¯è§€éŸ³è©è–©ã€‚',3:'ç­”æ¡ˆï¼šè§€éŸ³'}
        };
        alert(hints[locationNum][Math.min(hintCounters[locationNum],3)]);
        if (hintCounters[locationNum] === 3) {
            setTimeout(() => {
                hintCounters[locationNum] = 0;
                document.getElementById('hint-count-' + locationNum).textContent = '0';
            }, 2000);
        }
    }

    function showVideo(locationNum, type) {
        const videoInfo = {
            1: {history:{title:'ä¹é¾å¯¨åŸæ­·å²',youtubeId:'dQw4w9WgXcQ'},story:{title:'ä¹é¾å¯¨åŸæ•…äº‹é€²åº¦',youtubeId:'dQw4w9WgXcQ'}},
            2: {history:{title:'åä¸‰è¡—èˆŠæ¨“ç¾¤æ•…äº‹',youtubeId:'dQw4w9WgXcQ'},story:{title:'åä¸‰è¡—ç™¼å±•æ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            3: {history:{title:'ç‰›æ£šè—è¡“æ‘è½‰å‹',youtubeId:'dQw4w9WgXcQ'},story:{title:'ç‰›æ£šè—è¡“æ‘æ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            4: {history:{title:'æµ·å¿ƒå…¬åœ’èˆ‡é­šå°¾çŸ³å‚³èªª',youtubeId:'dQw4w9WgXcQ'},story:{title:'æµ·å¿ƒå…¬åœ’æ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            5: {history:{title:'å®‹çš‡è‡ºæ­·å²éºè·¡',youtubeId:'dQw4w9WgXcQ'},story:{title:'å®‹çš‡è‡ºæ•…äº‹',youtubeId:'dQw4w9WgXcQ'}},
            6: {history:{title:'ç´…ç£¡è§€éŸ³å»Ÿæ–‡åŒ–',youtubeId:'dQw4w9WgXcQ'},story:{title:'ç´…ç£¡è§€éŸ³å»Ÿæ•…äº‹',youtubeId:'dQw4w9WgXcQ'}}
        };
        const info = videoInfo[locationNum][type];
        document.getElementById('video-title').textContent = info.title;
        document.getElementById('video-description').textContent = info.title;
        document.getElementById('video-player').src = `https://www.youtube.com/embed/${info.youtubeId}?autoplay=1&rel=0`;
        document.getElementById('video-modal').style.display = 'flex';
    }

    function closeVideo() {
        document.getElementById('video-modal').style.display = 'none';
        document.getElementById('video-player').src = '';
    }

    function skipToLocation(n) {
        for (let i = 1; i <= totalLocations; i++) document.getElementById('location-' + i).style.display = 'none';
        document.getElementById('location-' + n).style.display = 'block';
        currentLocation = n;
        updateProgress();
        document.getElementById('completion').style.display = 'none';
    }

    function completeGame() {
        for (let i = 1; i <= totalLocations; i++) document.getElementById('location-' + i).style.display = 'none';
        document.getElementById('completion').style.display = 'block';
        currentLocation = totalLocations + 1;
        updateProgress();
    }

    function resetGame() {
        for (let i = 2; i <= totalLocations; i++) document.getElementById('location-' + i).style.display = 'none';
        document.getElementById('completion').style.display = 'none';
        document.getElementById('location-1').style.display = 'block';
        currentLocation = 1;
        updateProgress();
        for (let i = 1; i <= totalLocations; i++) {
            document.getElementById('answer-' + i).value = '';
            hintCounters[i] = 0;
            document.getElementById('hint-count-' + i).textContent = '0';
        }
    }

    function updateProgress() {
        const pc = Math.min(((currentLocation - 1) / totalLocations) * 100, 100);
        document.getElementById('progress-count').textContent = currentLocation - 1;
        document.getElementById('progress-percent').textContent = Math.round(pc);
        document.getElementById('remaining-percent').textContent = Math.round(100 - pc);
        document.getElementById('progress-fill').style.width = pc + '%';
    }

    /* ================= æ–°å¢ï¼šGPS è·é›¢ & å¯é¸å½±ç‰‡ ================= */
    const HERE = { lat: 22.317212, lng: 114.167039 }; // ä½ çµ¦çš„åº§æ¨™
    const POIS = [
        {id:1, name:'ä¹é¾å¯¨åŸå…¬åœ’',  lat:HERE.lat + 0.00080, lng:HERE.lng + 0.00080},
        {id:2, name:'åä¸‰è¡—èˆŠæ¨“ç¾¤', lat:HERE.lat - 0.00090, lng:HERE.lng + 0.00090},
        {id:3, name:'ç‰›æ£šè—è¡“æ‘',   lat:HERE.lat + 0.00100, lng:HERE.lng - 0.00070},
        {id:4, name:'æµ·å¿ƒå…¬åœ’',     lat:HERE.lat - 0.00110, lng:HERE.lng - 0.00060},
        {id:5, name:'å®‹çš‡è‡ºå…¬åœ’',   lat:HERE.lat + 0.00120, lng:HERE.lng + 0.00120},
        {id:6, name:'ç´…ç£¡è§€éŸ³å»Ÿ',   lat:HERE.lat - 0.00130, lng:HERE.lng + 0.00130}
    ];
    const VIDEOS = {   // ç•™ä½ï¼Œæ›æˆä½ çš„ YouTube ID
        1: {story: 'dQw4w9WgXcQ', hist: 'dQw4w9WgXcQ'},
        2: {story: 'AAA',         hist: 'BBB'},
        3: {story: 'CCC',         hist: 'DDD'},
        4: {story: 'EEE',         hist: 'FFF'},
        5: {story: 'GGG',         hist: 'HHH'},
        6: {story: 'III',         hist: 'JJJ'}
    };
    const TRIGGER_M = 200;   // æ¸¬è©¦åŠå¾‘ï¼Œä¸Šç·šæ”¹ 30
    const player   = document.getElementById('gpsPlayer');
    const overlay  = document.getElementById('gpsVideo');
    const prompt   = document.getElementById('gpsPrompt');
    let   pendingType = '';
    let   promptShownSet = new Set();

    function dist(a,b){
        const R=6371000, toRad=d=>d*Math.PI/180, dLat=toRad(b.lat-a.lat), dLng=toRad(b.lng-a.lng);
        const la1=toRad(a.lat), la2=toRad(b.lat);
        return 2*R*Math.asin(Math.sqrt(Math.sin(dLat/2)**2+Math.cos(la1)*Math.cos(la2)*Math.sin(dLng/2)**2));
    }
    function closePrompt(){ prompt.style.display='none'; }
    function playSelected(type){
        pendingType = type;
        const id = Number(prompt.dataset.poiId);
        overlay.style.display='block';
        player.src = `https://www.youtube.com/embed/${VIDEOS[id][type]}?autoplay=1&rel=0`;
        closePrompt();
        setTimeout(()=>{ overlay.style.display='none'; player.src=''; },20000);
    }

    function watchGPS(){
        navigator.geolocation.watchPosition(
            pos=>{
                const here={lat:pos.coords.latitude, lng:pos.coords.longitude};
                POIS.forEach(p=>{
                    const d = Math.round(dist(here,p));
                    const badge = document.getElementById('dist-'+p.id);
                    if(badge) badge.textContent = d<1000 ? d+' m' : (d/1000).toFixed(1)+' km';

                    if(d<TRIGGER_M && !promptShownSet.has(p.id)){
                        promptShownSet.add(p.id);
                        prompt.dataset.poiId = p.id;
                        document.getElementById('promptPoiName').textContent = p.name;
                        prompt.style.display='block';
                    }
                });
            },
            err=>console.warn('GPS éŒ¯èª¤:',err),
            {enableHighAccuracy:true, maximumAge:5000}
        );
    }
    window.addEventListener('load',()=>{
        if(navigator.geolocation) watchGPS();
        else alert('è£ç½®ä¸æ”¯æ´ GPSï¼Œç„¡æ³•ä½¿ç”¨è·é›¢èˆ‡å½±ç‰‡æç¤ºã€‚');
    });
    </script>

    <!-- èˆŠå½±ç‰‡æ¨¡æ…‹æ¡†ï¼ˆä¿æŒåŸæ¨£ï¼‰ -->
    <div id="video-modal" class="video-modal">
        <div class="video-content">
            <h2 id="video-title">å½±ç‰‡æ¨™é¡Œ</h2>
            <p class="video-description" id="video-description">å½±ç‰‡æè¿°å°‡é¡¯ç¤ºåœ¨é€™è£¡</p>
            <div class="video-container">
                <iframe id="video-player" width="560" height="315" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>
            <p class="ar-note">åœ¨ARç‰ˆæœ¬ä¸­ï¼Œé€™æ®µå½±ç‰‡æœƒåœ¨æ‚¨åˆ°é”åœ°é»æ™‚è‡ªå‹•æ’­æ”¾ï¼Œä¸¦èˆ‡å¯¦æ™¯çµåˆ</p>
            <button class="close-btn" onclick="closeVideo()">é—œé–‰å½±ç‰‡</button>
        </div>
    </div>
</body>
</html>
