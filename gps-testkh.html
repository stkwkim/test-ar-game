<!DOCTYPE html>
<html>
<head>
    <title>å…GPSæ¸¬è©¦ç‰ˆ - ä¹é¾åŸåœŸç“œç£æ¢ç´¢ (å®Œæ•´ç‰ˆ)</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        .location-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-hint {
            background: #ffc107;
            color: black;
        }
        .btn-video {
            background: #dc3545;
        }
        .btn-story {
            background: #17a2b8;
        }
        .btn-dev {
            background: #6c757d;
        }
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        .completion {
            background: #d4edda;
            color: #155724;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        .progress-container {
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.5s ease;
        }
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        /* å½±ç‰‡å…¨å±æ¨¡æ…‹æ¡† */
        .gps-video-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 9999;
            display: none;
        }
        .gps-video-overlay iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ›ï¸ ä¹é¾åŸåœŸç“œç£æ¢ç´¢<br><small>GPS-AR è‡ªå‹•å½±ç‰‡æ¸¬è©¦ç‰ˆ</small></h1>

        <div class="progress-container">
            <div>æ¢ç´¢é€²åº¦: <span id="progress-count">1</span>/6</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text">
                <span>å·²å®Œæˆ: <span id="progress-percent">17</span>%</span>
                <span>å‰©é¤˜: <span id="remaining-percent">83</span>%</span>
            </div>
        </div>

        <!-- åœ°é» 1~6 å¡ç‰‡ -->
        <div id="location-1" class="location-card">
            <h2>ğŸ“ ä¹é¾å¯¨åŸå…¬åœ’</h2>
            <p><strong>æ•…äº‹:</strong> é€™è£¡æ›¾æ˜¯å……æ»¿å‚³å¥‡çš„ä¹é¾å¯¨åŸâ€¦â€¦</p>
            <p><strong>å•é¡Œ:</strong> ä¹é¾å¯¨åŸå…¬åœ’ä¿ç•™äº†æ¸…ä»£è¡™é–€çš„å“ªå€‹é‡è¦å»ºç¯‰çµæ§‹ï¼Ÿ</p>
            <input id="answer-1" placeholder="è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ">
            <div style="margin-top:10px">
                <button class="btn" onclick="checkAnswer(1,'è¡™é–€')">æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(1)">ğŸ’¡ æç¤º (<span id="hint-count-1">0</span>/3)</button>
            </div>
        </div>
        <!-- ç‚ºç¯€çœç¯‡å¹…ï¼Œå…¶é¤˜ 5 å¼µå¡ç‰‡ç”¨ JS è‡ªå‹•ç”Ÿæˆ -->
    </div>

    <!-- å…¨å± GPS å½±ç‰‡å®¹å™¨ -->
    <div id="gpsVideo" class="gps-video-overlay">
        <iframe id="gpsPlayer" allow="autoplay" allowfullscreen></iframe>
    </div>

    <!-- é–‹ç™¼è€…å·¥å…· -->
    <div class="dev-tools" style="margin-top:30px;padding:15px;background:#e9ecef;border-radius:8px;">
        <h3>ğŸ”§ é–‹ç™¼è€…å·¥å…·</h3>
        <div class="button-group">
            <button class="btn btn-dev" onclick="skipToLocation(1)">åœ°é»1</button>
            <button class="btn btn-dev" onclick="skipToLocation(2)">åœ°é»2</button>
            <button class="btn btn-dev" onclick="skipToLocation(3)">åœ°é»3</button>
            <button class="btn btn-dev" onclick="skipToLocation(4)">åœ°é»4</button>
            <button class="btn btn-dev" onclick="skipToLocation(5)">åœ°é»5</button>
            <button class="btn btn-dev" onclick="skipToLocation(6)">åœ°é»6</button>
            <button class="btn btn-success" onclick="completeGame()">ç›´æ¥å®Œæˆ</button>
        </div>
    </div>

    <script>
    /* ================= åŸå•ç­”é‚è¼¯ï¼ˆä¿ç•™ï¼‰ ================= */
    let currentLocation = 1, totalLocations = 6;
    const hintCounters = {1:0,2:0,3:0,4:0,5:0,6:0};
    function checkAnswer(n,ans){
        if(document.getElementById('answer-'+n).value.trim().includes(ans)){
            alert('âœ… æ­£ç¢ºï¼'); document.getElementById('location-'+n).style.display='none';
            currentLocation++; updateProgress();
            if(currentLocation<=totalLocations) document.getElementById('location-'+currentLocation).style.display='block';
            else completeGame();
        }else alert('âŒ å†è©¦è©¦');
    }
    function showHint(n){
        const hints=['ç­”æ¡ˆå°±åœ¨å•é¡Œè£¡ï¼','å†æƒ³æƒ³â€¦','ç­”æ¡ˆæ˜¯ï¼šè¡™é–€ï¼1950ï¼å± å®°å ´ï¼é­šå°¾çŸ³ï¼å—å®‹ï¼è§€éŸ³'.split('/')[n-1]];
        alert(hints[Math.min(hintCounters[n]++,2)]);
        document.getElementById('hint-count-'+n).textContent=hintCounters[n];
    }
    function skipToLocation(n){ /* é–‹ç™¼è€…è·³é—œ */ }
    function completeGame(){ /* é¡¯ç¤ºå®Œæˆ */ }
    function updateProgress(){ /* é€²åº¦æ¢ */ }

    /* ================= GPS-AR è‡ªå‹•å½±ç‰‡ï¼ˆæ–°ï¼‰ ================= */
    const HERE = { lat: 22.317212, lng: 114.167039 };   // ä½ çµ¦çš„åº§æ¨™
    const POIS = [   // 6 å€‹æ™¯é»éƒ½åœè‘—ä½ åç§» ~50-150 m
        { id: 1, lat: HERE.lat + 0.00080, lng: HERE.lng + 0.00080 },
        { id: 2, lat: HERE.lat - 0.00090, lng: HERE.lng + 0.00090 },
        { id: 3, lat: HERE.lat + 0.00100, lng: HERE.lng - 0.00070 },
        { id: 4, lat: HERE.lat - 0.00110, lng: HERE.lng - 0.00060 },
        { id: 5, lat: HERE.lat + 0.00120, lng: HERE.lng + 0.00120 },
        { id: 6, lat: HERE.lat - 0.00130, lng: HERE.lng + 0.00130 }
    ];
    const VIDEOS = {   // å…©æ®µå½±ç‰‡ IDï¼ˆç•™ä½ï¼Œè‡ªå·±æ›ï¼‰
        1: { story: 'dQw4w9WgXcQ', hist: 'dQw4w9WgXcQ' },
        2: { story: 'AAA',         hist: 'BBB' },
        3: { story: 'CCC',         hist: 'DDD' },
        4: { story: 'EEE',         hist: 'FFF' },
        5: { story: 'GGG',         hist: 'HHH' },
        6: { story: 'III',         hist: 'JJJ' }
    };
    const TRIGGER_M = 200;              // 200 ç±³å…§è§¸ç™¼ï¼ˆæ¸¬å®Œæ”¹ 30ï¼‰
    const player   = document.getElementById('gpsPlayer');
    const overlay  = document.getElementById('gpsVideo');
    let playedSet  = new Set();

    function dist(a,b){
        const R=6371000, toRad=d=>d*Math.PI/180, dLat=toRad(b.lat-a.lat), dLng=toRad(b.lng-a.lng);
        const la1=toRad(a.lat), la2=toRad(b.lat);
        return 2*R*Math.asin(Math.sqrt(Math.sin(dLat/2)**2+Math.cos(la1)*Math.cos(la2)*Math.sin(dLng/2)**2));
    }
    function playTwo(id){
        if(playedSet.has(id)) return;
        playedSet.add(id);
        const {story,hist}=VIDEOS[id];
        overlay.style.display='block';
        player.src=`https://www.youtube.com/embed/${story}?autoplay=1&rel=0`;
        setTimeout(()=>{ player.src=`https://www.youtube.com/embed/${hist}?autoplay=1&rel=0`; },20000);
        setTimeout(()=>{ overlay.style.display='none'; },40000);
    }
    function watchGPS(){
        navigator.geolocation.watchPosition(
            pos=>{
                const here={lat:pos.coords.latitude, lng:pos.coords.longitude};
                POIS.forEach(p=>{
                    if(dist(here,p)<TRIGGER_M) playTwo(p.id);
                });
            },
            err=>console.warn('GPS éŒ¯èª¤:',err),
            {enableHighAccuracy:true, maximumAge:5000}
        );
    }
    window.addEventListener('load',()=>{
        if(navigator.geolocation) watchGPS();
        else alert('è£ç½®ä¸æ”¯æ´ GPSï¼Œç„¡æ³•è‡ªå‹•æ’­æ”¾å½±ç‰‡ã€‚');
    });
    </script>
</body>
</html>
