<!DOCTYPE html>
<html>
<head>
    <title>GPSé©—è­‰ç‰ˆæœ¬ - ä¹é¾åŸåœŸç“œç£æ¢ç´¢</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 30px;
        }
        .location-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        .btn:hover {
            background: #5a6fd8;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-hint {
            background: #ffc107;
            color: black;
        }
        .btn-video {
            background: #dc3545;
        }
        .btn-story {
            background: #17a2b8;
        }
        .btn-dev {
            background: #6c757d;
        }
        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        input:disabled {
            background: #e9ecef;
            cursor: not-allowed;
        }
        .completion {
            background: #d4edda;
            color: #155724;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            display: none;
        }
        .progress-container {
            text-align: center;
            margin: 20px 0;
            font-weight: bold;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            width: 0%;
            transition: width 0.5s ease;
        }
        .progress-text {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        /* å½±ç‰‡æ¨¡æ…‹æ¡†æ¨£å¼ */
        .video-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .video-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            text-align: center;
        }
        .video-container {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 æ¯”ä¾‹ */
            height: 0;
            margin: 20px 0;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 8px;
        }
        .close-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .video-description {
            margin: 15px 0;
            color: #555;
            font-style: italic;
        }
        .ar-note {
            background: #e7f3ff;
            color: #004085;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9em;
        }
        .dev-tools {
            margin-top: 30px;
            padding: 15px;
            background: #e9ecef;
            border-radius: 8px;
        }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;
        }
        .hint-counter {
            font-size: 0.8em;
            color: #6c757d;
            margin-top: 5px;
            text-align: center;
        }
        /* äºŒç¶­ç¢¼æ¨£å¼ */
        .qr-code {
            margin: 20px auto;
            text-align: center;
        }
        .qr-code img {
            max-width: 200px;
            border: 2px solid #333;
            border-radius: 10px;
        }
        .qr-instruction {
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }
        .gps-status {
            padding: 10px;
            border-radius: 8px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
        }
        .gps-active {
            background: #d4edda;
            color: #155724;
        }
        .gps-inactive {
            background: #f8d7da;
            color: #721c24;
        }
        .location-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 1001;
            display: none;
        }
        .verification-message {
            background: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="location-notification" id="location-notification">
        ğŸ‰ æ‚¨å·²åˆ°é”ç›®çš„åœ°ï¼æ­£åœ¨æ’­æ”¾å½±ç‰‡...
    </div>

    <div class="container">
        <h1>ğŸ›ï¸ ä¹é¾åŸåœŸç“œç£æ¢ç´¢<br><small>GPSé©—è­‰ç‰ˆæœ¬</small></h1>
        
        <div class="gps-status" id="gps-status">
            æ­£åœ¨å•Ÿå‹•GPSå®šä½...
        </div>
        
        <div class="progress-container">
            <div>æ¢ç´¢é€²åº¦: <span id="progress-count">0</span>/1</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-text">
                <span>å·²å®Œæˆ: <span id="progress-percent">0</span>%</span>
                <span>å‰©é¤˜: <span id="remaining-percent">100</span>%</span>
            </div>
        </div>

        <!-- ä¹é¾å¯¨åŸå…¬åœ’ -->
        <div id="location-1" class="location-card">
            <h2>ğŸ“ ä¹é¾å¯¨åŸå…¬åœ’</h2>
            <p><strong>æ•…äº‹:</strong> é€™è£¡æ›¾æ˜¯å……æ»¿å‚³å¥‡çš„ä¹é¾å¯¨åŸï¼Œä¸€å€‹åœ¨ä¸‰ä¸ç®¡åœ°å¸¶ä¸­è‡ªç„¶å½¢æˆçš„ç¨ç‰¹ç¤¾å€ã€‚æƒ³åƒä¸€ä¸‹ï¼Œåœ¨1987å¹´æ¸…æ‹†ä¹‹å‰ï¼Œé€™è£¡æ˜¯é«˜å¯†åº¦å»ºç¯‰çš„è¿·å®®ï¼Œå……æ»¿è‘—å„ç¨®æ•…äº‹å’Œå‚³å¥‡ã€‚</p>
            
            <div class="ar-note">
                ğŸ’¡ GPSç‰ˆæœ¬ä¸­ï¼Œç•¶æ‚¨åˆ°é”æ­¤åœ°é»æ™‚ï¼Œæœƒè‡ªå‹•é¡¯ç¤ºç›¸é—œçš„ARå½±ç‰‡å…§å®¹
            </div>
            
            <div class="button-group">
                <button class="btn btn-video" onclick="showVideo(1, 'history')">ğŸ¬ è§€çœ‹ä¹é¾å¯¨åŸæ­·å²å½±ç‰‡</button>
                <button class="btn btn-story" onclick="showVideo(1, 'story')">ğŸ“– æ•…äº‹é€²åº¦</button>
            </div>
            
            <div class="verification-message" id="verification-message-1">
                âŒ æ‚¨å°šæœªåˆ°é”ä¹é¾å¯¨åŸå…¬åœ’ï¼Œç„¡æ³•å›ç­”å•é¡Œ
            </div>
            
            <p><strong>å•é¡Œ:</strong> ä¹é¾å¯¨åŸå…¬åœ’ä¿ç•™äº†æ¸…ä»£è¡™é–€çš„å“ªå€‹é‡è¦å»ºç¯‰çµæ§‹ï¼Ÿ</p>
            <input type="text" id="answer-1" placeholder="è«‹å…ˆåˆ°é”åœ°é»ä»¥è§£é–å•é¡Œ" disabled>
            
            <div class="button-group">
                <button class="btn" id="submit-1" onclick="checkAnswer(1, 'è¡™é–€')" disabled>æäº¤ç­”æ¡ˆ</button>
                <button class="btn btn-hint" onclick="showHint(1)">ğŸ’¡ é¡¯ç¤ºæç¤º (<span id="hint-count-1">0</span>/3)</button>
            </div>
            
            <div class="hint-counter">é»æ“Šæç¤ºæŒ‰éˆ•ç²å¾—æ›´å¤šç·šç´¢</div>
        </div>

        <!-- å®Œæˆæ…¶ç¥ -->
        <div id="completion" class="completion">
            <h2>ğŸ‰ æ­å–œæ‚¨å®Œæˆæ¢ç´¢ï¼</h2>
            <p>æ‚¨å·²æˆåŠŸå®Œæˆä¹é¾å¯¨åŸå…¬åœ’çš„æ¢ç´¢ï¼</p>
            
            <div class="qr-code">
                <h3>å®Œæˆçå‹µäºŒç¶­ç¢¼</h3>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=0168" alt="å®Œæˆçå‹µäºŒç¶­ç¢¼">
                <p class="qr-instruction">æƒææ­¤äºŒç¶­ç¢¼å¯ç²å¾—æ•¸å­—ä»£ç¢¼: 0168</p>
            </div>
            
            <button class="btn btn-success" onclick="resetGame()">é‡æ–°é–‹å§‹éŠæˆ²</button>
        </div>

        <!-- é–‹ç™¼è€…å·¥å…· -->
        <div class="dev-tools">
            <h3>ğŸ”§ é–‹ç™¼è€…å·¥å…·</h3>
            <p>å¿«é€Ÿæ¸¬è©¦GPSåŠŸèƒ½ï¼š</p>
            <div class="button-group">
                <button class="btn btn-dev" onclick="simulateLocation()">æ¨¡æ“¬åˆ°é”ç›®çš„åœ°</button>
                <button class="btn btn-success" onclick="completeGame()">ç›´æ¥å®ŒæˆéŠæˆ²</button>
            </div>
        </div>
    </div>

    <!-- å½±ç‰‡æ¨¡æ…‹æ¡† -->
    <div id="video-modal" class="video-modal">
        <div class="video-content">
            <h2 id="video-title">å½±ç‰‡æ¨™é¡Œ</h2>
            <p class="video-description" id="video-description">å½±ç‰‡æè¿°å°‡é¡¯ç¤ºåœ¨é€™è£¡</p>
            
            <div class="video-container">
                <iframe id="video-player" width="560" height="315" src="" frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                    allowfullscreen>
                </iframe>
            </div>
            
            <p class="ar-note">åœ¨GPSç‰ˆæœ¬ä¸­ï¼Œé€™æ®µå½±ç‰‡æœƒåœ¨æ‚¨åˆ°é”åœ°é»æ™‚è‡ªå‹•æ’­æ”¾ï¼Œä¸¦èˆ‡å¯¦æ™¯çµåˆ</p>
            
            <button class="close-btn" onclick="closeVideo()">é—œé–‰å½±ç‰‡</button>
        </div>
    </div>

    <script>
        // ç›®æ¨™ä½ç½®åæ¨™
        const TARGET_LAT = 22.317212;
        const TARGET_LNG = 114.167039;
        const TRIGGER_RADIUS = 0.05; // è§¸ç™¼åŠå¾‘ï¼ˆå…¬é‡Œï¼‰
        
        let currentLocation = 0;
        const totalLocations = 1;
        let watchId = null;
        let isAtLocation = false;
        let locationVerified = false;
        
        // æç¤ºè¨ˆæ•¸å™¨
        const hintCounters = {
            1: 0
        };
        
        // æç¤ºå…§å®¹
        const hintContents = {
            1: {
                1: 'æç¤ºï¼šç­”æ¡ˆå°±åœ¨å•é¡Œä¸­ï¼ç•™æ„ã€Œè¡™é–€ã€é€™å€‹è©ã€‚',
                2: 'æç¤ºï¼šæ¸…ä»£è¡™é–€çš„é‡è¦å»ºç¯‰çµæ§‹å°±æ˜¯ã€Œè¡™é–€ã€æœ¬èº«ã€‚',
                3: 'ç­”æ¡ˆï¼šè¡™é–€'
            }
        };
        
        // å½±ç‰‡è³‡è¨Š
        const videoData = {
            1: {
                history: {
                    title: "ä¹é¾å¯¨åŸæ­·å²",
                    description: "æ¢ç´¢ä¹é¾å¯¨åŸçš„å‚³å¥‡æ­·å²ï¼Œå¾æ¸…ä»£è»äº‹è¦å¡åˆ°ç¨ç‰¹çš„åŸä¸­åŸç¤¾å€",
                    youtubeId: "dQw4w9WgXcQ" // è«‹æ›¿æ›ç‚ºçœŸå¯¦çš„å½±ç‰‡ID
                },
                story: {
                    title: "ä¹é¾å¯¨åŸæ•…äº‹é€²åº¦",
                    description: "äº†è§£ä¹é¾å¯¨åŸçš„ç™¼å±•æ­·ç¨‹èˆ‡ç¤¾å€è®Šé·",
                    youtubeId: "dQw4w9WgXcQ" // è«‹æ›¿æ›ç‚ºçœŸå¯¦çš„å½±ç‰‡ID
                }
            }
        };

        // åˆå§‹åŒ–é€²åº¦é¡¯ç¤º
        updateProgress();
        
        // å•Ÿå‹•GPSç›£æ§
        startGPSMonitoring();

        function startGPSMonitoring() {
            if (navigator.geolocation) {
                document.getElementById('gps-status').textContent = "GPSå®šä½å·²å•Ÿå‹•ï¼Œæ­£åœ¨ç›£æ§æ‚¨çš„ä½ç½®...";
                document.getElementById('gps-status').className = "gps-status gps-active";
                
                // é–‹å§‹ç›£æ§ä½ç½®
                watchId = navigator.geolocation.watchPosition(
                    handlePositionUpdate,
                    handlePositionError,
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 60000
                    }
                );
            } else {
                document.getElementById('gps-status').textContent = "æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒGPSå®šä½åŠŸèƒ½";
                document.getElementById('gps-status').className = "gps-status gps-inactive";
            }
        }

        function handlePositionUpdate(position) {
            const userLat = position.coords.latitude;
            const userLng = position.coords.longitude;
            
            // è¨ˆç®—èˆ‡ç›®æ¨™ä½ç½®çš„è·é›¢
            const distance = calculateDistance(userLat, userLng, TARGET_LAT, TARGET_LNG);
            
            // å¦‚æœè·é›¢å°æ–¼è§¸ç™¼åŠå¾‘ï¼Œä¸”ä¹‹å‰ä¸åœ¨ä½ç½®ï¼Œå‰‡è§¸ç™¼
            if (distance <= TRIGGER_RADIUS && !isAtLocation) {
                isAtLocation = true;
                locationVerified = true;
                unlockLocation();
            } else if (distance > TRIGGER_RADIUS) {
                isAtLocation = false;
                // å¦‚æœç”¨æˆ¶é›¢é–‹ä½ç½®ï¼Œé‡æ–°é–å®šå•é¡Œ
                if (locationVerified) {
                    lockLocation();
                }
            }
            
            // æ›´æ–°GPSç‹€æ…‹é¡¯ç¤º
            document.getElementById('gps-status').innerHTML = 
                `GPSå®šä½å·²å•Ÿå‹•<br>è·é›¢ç›®æ¨™: ${(distance * 1000).toFixed(0)} ç±³`;
        }

        function handlePositionError(error) {
            let errorMessage = "ç„¡æ³•ç²å–æ‚¨çš„ä½ç½®ä¿¡æ¯: ";
            
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage += "ç”¨æˆ¶æ‹’çµ•äº†ä½ç½®è«‹æ±‚";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage += "ä½ç½®ä¿¡æ¯ä¸å¯ç”¨";
                    break;
                case error.TIMEOUT:
                    errorMessage += "ç²å–ä½ç½®ä¿¡æ¯è¶…æ™‚";
                    break;
                default:
                    errorMessage += "æœªçŸ¥éŒ¯èª¤";
                    break;
            }
            
            document.getElementById('gps-status').textContent = errorMessage;
            document.getElementById('gps-status').className = "gps-status gps-inactive";
        }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            // ä½¿ç”¨å“ˆå¼—è¾›å…¬å¼è¨ˆç®—å…©é»é–“è·é›¢ï¼ˆå–®ä½ï¼šå…¬é‡Œï¼‰
            const R = 6371; // åœ°çƒåŠå¾‘ï¼ˆå…¬é‡Œï¼‰
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = 
                Math.sin(dLat/2) * Math.sin(dLat/2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
                Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c;
            return distance;
        }

        function unlockLocation() {
            // é¡¯ç¤ºé€šçŸ¥
            const notification = document.getElementById('location-notification');
            notification.style.display = 'block';
            
            // 3ç§’å¾Œéš±è—é€šçŸ¥
            setTimeout(() => {
                notification.style.display = 'none';
            }, 5000);
            
            // æ›´æ–°é©—è­‰æ¶ˆæ¯
            document.getElementById('verification-message-1').innerHTML = 
                "âœ… æ‚¨å·²åˆ°é”ä¹é¾å¯¨åŸå…¬åœ’ï¼ç¾åœ¨å¯ä»¥å›ç­”å•é¡Œ";
            document.getElementById('verification-message-1').style.background = "#d4edda";
            document.getElementById('verification-message-1').style.color = "#155724";
            
            // å•Ÿç”¨è¼¸å…¥æ¡†å’Œæäº¤æŒ‰éˆ•
            document.getElementById('answer-1').disabled = false;
            document.getElementById('answer-1').placeholder = "è¼¸å…¥æ‚¨çš„ç­”æ¡ˆ";
            document.getElementById('submit-1').disabled = false;
            
            // æ›´æ–°ç•¶å‰ä½ç½®
            currentLocation = 1;
            
            // æ›´æ–°é€²åº¦
            updateProgress();
            
            // è‡ªå‹•æ’­æ”¾å½±ç‰‡ - å…ˆæ’­æ”¾æ•…äº‹å½±ç‰‡ï¼Œç„¶å¾Œæ’­æ”¾æ­·å²å½±ç‰‡
            playStoryVideo();
        }

        function lockLocation() {
            // æ›´æ–°é©—è­‰æ¶ˆæ¯
            document.getElementById('verification-message-1').innerHTML = 
                "âŒ æ‚¨å·²é›¢é–‹ä¹é¾å¯¨åŸå…¬åœ’ï¼Œç„¡æ³•å›ç­”å•é¡Œ";
            document.getElementById('verification-message-1').style.background = "#fff3cd";
            document.getElementById('verification-message-1').style.color = "#856404";
            
            // ç¦ç”¨è¼¸å…¥æ¡†å’Œæäº¤æŒ‰éˆ•
            document.getElementById('answer-1').disabled = true;
            document.getElementById('answer-1').placeholder = "è«‹å…ˆåˆ°é”åœ°é»ä»¥è§£é–å•é¡Œ";
            document.getElementById('submit-1').disabled = true;
            
            locationVerified = false;
        }

        function playStoryVideo() {
            const storyVideo = videoData[1].story;
            if (storyVideo) {
                // é¡¯ç¤ºå½±ç‰‡æ¨¡æ…‹æ¡†
                document.getElementById('video-title').textContent = storyVideo.title;
                document.getElementById('video-description').textContent = storyVideo.description;
                document.getElementById('video-player').src = `https://www.youtube.com/embed/${storyVideo.youtubeId}?autoplay=1`;
                document.getElementById('video-modal').style.display = 'flex';
                
                // ç›£è½å½±ç‰‡çµæŸäº‹ä»¶ï¼Œä»¥ä¾¿æ’­æ”¾æ­·å²å½±ç‰‡
                const iframe = document.getElementById('video-player');
                iframe.onload = function() {
                    // è¨­ç½®å®šæ™‚å™¨æª¢æŸ¥å½±ç‰‡æ˜¯å¦çµæŸï¼ˆé€™æ˜¯ä¸€å€‹ç°¡åŒ–æ–¹æ¡ˆï¼Œå¯¦éš›æ‡‰ç”¨ä¸­æ‡‰ä½¿ç”¨YouTube APIï¼‰
                    setTimeout(() => {
                        // å‡è¨­å½±ç‰‡é•·åº¦ç‚º3åˆ†é˜ï¼Œ3åˆ†é˜å¾Œè‡ªå‹•æ’­æ”¾æ­·å²å½±ç‰‡
                        playHistoryVideo();
                    }, 180000); // 3åˆ†é˜
                };
            }
        }

        function playHistoryVideo() {
            const historyVideo = videoData[1].history;
            if (historyVideo) {
                // é¡¯ç¤ºå½±ç‰‡æ¨¡æ…‹æ¡†
                document.getElementById('video-title').textContent = historyVideo.title;
                document.getElementById('video-description').textContent = historyVideo.description;
                document.getElementById('video-player').src = `https://www.youtube.com/embed/${historyVideo.youtubeId}?autoplay=1`;
                document.getElementById('video-modal').style.display = 'flex';
            }
        }

        function checkAnswer(locationNum, correctAnswer) {
            // æª¢æŸ¥æ˜¯å¦åœ¨æ­£ç¢ºä½ç½®
            if (!locationVerified) {
                alert('âŒ æ‚¨éœ€è¦åˆ°é”ä¹é¾å¯¨åŸå…¬åœ’æ‰èƒ½å›ç­”å•é¡Œï¼');
                return;
            }
            
            const userAnswer = document.getElementById('answer-' + locationNum).value.trim().toLowerCase();
            const correct = correctAnswer.toLowerCase();
            
            // æ›´å¯¬é¬†çš„ç­”æ¡ˆæª¢æŸ¥
            let isCorrect = false;
            
            // æª¢æŸ¥å®Œå…¨åŒ¹é…
            if (userAnswer === correct) {
                isCorrect = true;
            }
            // æª¢æŸ¥åŒ…å«é—œä¿‚
            else if (userAnswer.includes(correct) || correct.includes(userAnswer)) {
                isCorrect = true;
            }
            
            if (isCorrect) {
                alert('âœ… ç­”æ¡ˆæ­£ç¢ºï¼æ­å–œæ‚¨å®Œæˆé€™å€‹åœ°é»çš„æ¢ç´¢ï¼');
                
                // å®ŒæˆéŠæˆ²
                completeGame();
                
                // æ¸…ç©ºç­”æ¡ˆæ¡†
                document.getElementById('answer-' + locationNum).value = '';
                
            } else {
                alert('âŒ ç­”æ¡ˆä¸æ­£ç¢ºï¼Œè«‹å†è©¦ä¸€æ¬¡æˆ–æŸ¥çœ‹æç¤ºã€‚\n\næç¤ºï¼šç­”æ¡ˆé€šå¸¸æ˜¯1-3å€‹å­—çš„é—œéµè©ã€‚');
            }
        }

        function showHint(locationNum) {
            // å¢åŠ æç¤ºè¨ˆæ•¸
            hintCounters[locationNum]++;
            
            // æ›´æ–°æç¤ºæŒ‰éˆ•ä¸Šçš„è¨ˆæ•¸
            document.getElementById('hint-count-' + locationNum).textContent = hintCounters[locationNum];
            
            // æ ¹æ“šæç¤ºæ¬¡æ•¸é¡¯ç¤ºä¸åŒçš„æç¤º
            const hintLevel = Math.min(hintCounters[locationNum], 3);
            
            if (hintContents[locationNum] && hintContents[locationNum][hintLevel]) {
                alert(hintContents[locationNum][hintLevel]);
            }
            
            // å¦‚æœå·²ç¶“é¡¯ç¤ºäº†ç­”æ¡ˆï¼Œå‰‡ç¦ç”¨æç¤ºæŒ‰éˆ•
            if (hintLevel >= 3) {
                document.querySelector(`#location-${locationNum} .btn-hint`).disabled = true;
            }
        }

        function showVideo(locationNum, type) {
            const videoInfo = videoData[locationNum][type];
            if (videoInfo) {
                document.getElementById('video-title').textContent = videoInfo.title;
                document.getElementById('video-description').textContent = videoInfo.description;
                document.getElementById('video-player').src = `https://www.youtube.com/embed/${videoInfo.youtubeId}`;
                document.getElementById('video-modal').style.display = 'flex';
            }
        }

        function closeVideo() {
            document.getElementById('video-modal').style.display = 'none';
            document.getElementById('video-player').src = '';
        }

        function updateProgress() {
            const progressPercent = Math.round((currentLocation / totalLocations) * 100);
            const remainingPercent = 100 - progressPercent;
            
            document.getElementById('progress-count').textContent = currentLocation;
            document.getElementById('progress-percent').textContent = progressPercent;
            document.getElementById('remaining-percent').textContent = remainingPercent;
            document.getElementById('progress-fill').style.width = `${progressPercent}%`;
        }

        function completeGame() {
            // é¡¯ç¤ºå®Œæˆç•«é¢
            document.getElementById('completion').style.display = 'block';
            
            // æ›´æ–°é€²åº¦
            currentLocation = totalLocations;
            updateProgress();
        }

        function resetGame() {
            // é‡ç½®æ‰€æœ‰ç‹€æ…‹
            currentLocation = 0;
            isAtLocation = false;
            locationVerified = false;
            
            // é‡ç½®æç¤ºè¨ˆæ•¸å™¨
            for (let i = 1; i <= totalLocations; i++) {
                hintCounters[i] = 0;
                document.getElementById('hint-count-' + i).textContent = '0';
                document.querySelector(`#location-${i} .btn-hint`).disabled = false;
                document.getElementById('answer-' + i).value = '';
            }
            
            // é‡ç½®é©—è­‰æ¶ˆæ¯
            document.getElementById('verification-message-1').innerHTML = 
                "âŒ æ‚¨å°šæœªåˆ°é”ä¹é¾å¯¨åŸå…¬åœ’ï¼Œç„¡æ³•å›ç­”å•é¡Œ";
            document.getElementById('verification-message-1').style.background = "#fff3cd";
            document.getElementById('verification-message-1').style.color = "#856404";
            
            // ç¦ç”¨è¼¸å…¥æ¡†å’Œæäº¤æŒ‰éˆ•
            document.getElementById('answer-1').disabled = true;
            document.getElementById('answer-1').placeholder = "è«‹å…ˆåˆ°é”åœ°é»ä»¥è§£é–å•é¡Œ";
            document.getElementById('submit-1').disabled = true;
            
            // éš±è—å®Œæˆç•«é¢
            document.getElementById('completion').style.display = 'none';
            
            // é‡æ–°å•Ÿå‹•GPSç›£æ§
            if (watchId) {
                navigator.geolocation.clearWatch(watchId);
            }
            startGPSMonitoring();
            
            updateProgress();
        }

        function simulateLocation() {
            // æ¨¡æ“¬åˆ°é”æŒ‡å®šåœ°é»
            unlockLocation();
        }

        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰å½±ç‰‡
        document.getElementById('video-modal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeVideo();
            }
        });
    </script>
</body>
</html>
